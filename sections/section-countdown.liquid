{%- comment -%}
  Countdown - Timer section for promotions
{%- endcomment -%}

<section class="countdown" data-section-id="{{ section.id }}" style="background: {{ section.settings.bg_color }};">
  <div class="container">
    <div class="countdown__inner">
      {%- if section.settings.heading != blank -%}
        <h2 class="countdown__heading" style="color: {{ section.settings.text_color }};">
          {{ section.settings.heading }}
        </h2>
      {%- endif -%}
      
      {%- if section.settings.text != blank -%}
        <p class="countdown__text" style="color: {{ section.settings.text_color }};">
          {{ section.settings.text }}
        </p>
      {%- endif -%}

      <div class="countdown__timer" data-countdown="{{ section.settings.end_date }}">
        <div class="countdown__unit">
          <span class="countdown__number" data-days>00</span>
          <span class="countdown__label" style="color: {{ section.settings.text_color }};">Days</span>
        </div>
        <div class="countdown__separator">:</div>
        <div class="countdown__unit">
          <span class="countdown__number" data-hours>00</span>
          <span class="countdown__label" style="color: {{ section.settings.text_color }};">Hours</span>
        </div>
        <div class="countdown__separator">:</div>
        <div class="countdown__unit">
          <span class="countdown__number" data-minutes>00</span>
          <span class="countdown__label" style="color: {{ section.settings.text_color }};">Min</span>
        </div>
        <div class="countdown__separator">:</div>
        <div class="countdown__unit">
          <span class="countdown__number" data-seconds>00</span>
          <span class="countdown__label" style="color: {{ section.settings.text_color }};">Sec</span>
        </div>
      </div>

      {%- if section.settings.button_label != blank -%}
        <a href="{{ section.settings.button_link }}" class="countdown__btn">
          {{ section.settings.button_label }}
        </a>
      {%- endif -%}
    </div>
  </div>
</section>

<script>
  (function() {
    const timer = document.querySelector('[data-countdown]');
    if (!timer) return;
    
    const endDate = new Date(timer.dataset.countdown).getTime();
    
    function update() {
      const now = new Date().getTime();
      const diff = endDate - now;
      
      if (diff <= 0) {
        timer.querySelectorAll('[data-days], [data-hours], [data-minutes], [data-seconds]').forEach(el => el.textContent = '00');
        return;
      }
      
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((diff % (1000 * 60)) / 1000);
      
      timer.querySelector('[data-days]').textContent = String(days).padStart(2, '0');
      timer.querySelector('[data-hours]').textContent = String(hours).padStart(2, '0');
      timer.querySelector('[data-minutes]').textContent = String(minutes).padStart(2, '0');
      timer.querySelector('[data-seconds]').textContent = String(seconds).padStart(2, '0');
    }
    
    update();
    setInterval(update, 1000);
  })();
</script>

{% style %}
  .countdown {
    padding: {{ section.settings.padding_top }}px 0 {{ section.settings.padding_bottom }}px;
    text-align: center;
  }

  .countdown__inner {
    max-width: 40rem;
    margin: 0 auto;
  }

  .countdown__heading {
    font-size: 1.75rem;
    font-family: 'Space Grotesk', monospace;
    font-weight: 300;
    margin-bottom: 0.5rem;
  }

  .countdown__text {
    font-size: 1rem;
    opacity: 0.8;
    margin-bottom: 2rem;
  }

  .countdown__timer {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .countdown__unit {
    text-align: center;
  }

  .countdown__number {
    display: block;
    font-size: 2.5rem;
    font-family: 'Space Grotesk', monospace;
    font-weight: 300;
    color: {{ section.settings.text_color }};
  }

  @media (min-width: 768px) {
    .countdown__number {
      font-size: 3.5rem;
    }
  }

  .countdown__label {
    font-size: 0.6875rem;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    opacity: 0.6;
  }

  .countdown__separator {
    font-size: 2rem;
    color: {{ section.settings.text_color }};
    opacity: 0.3;
  }

  .countdown__btn {
    display: inline-block;
    padding: 0.875rem 2rem;
    background: #fff;
    color: #000;
    font-size: 0.75rem;
    font-family: 'Space Grotesk', monospace;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    text-decoration: none;
    transition: all 0.3s;
  }

  .countdown__btn:hover {
    background: #000;
    color: #fff;
  }
{% endstyle %}

{% schema %}
{
  "name": "Countdown",
  "tag": "section",
  "class": "section-countdown",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Sale Ends Soon"
    },
    {
      "type": "text",
      "id": "text",
      "label": "Text",
      "default": "Don't miss out on exclusive offers"
    },
    {
      "type": "text",
      "id": "end_date",
      "label": "End Date (YYYY-MM-DD)",
      "default": "2026-12-31",
      "info": "Format: YYYY-MM-DD"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "Button Label",
      "default": "Shop Now"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Button Link"
    },
    {
      "type": "header",
      "content": "Style"
    },
    {
      "type": "color",
      "id": "bg_color",
      "label": "Background",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Text Color",
      "default": "#ffffff"
    },
    {
      "type": "range",
      "id": "padding_top",
      "label": "Padding Top",
      "min": 20, "max": 100, "step": 10, "default": 60, "unit": "px"
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "label": "Padding Bottom",
      "min": 20, "max": 100, "step": 10, "default": 60, "unit": "px"
    }
  ],
  "presets": [
    {
      "name": "Countdown"
    }
  ]
}
{% endschema %}

